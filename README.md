# gorg-classifier-v2
Recruit, classify, and annotate reads against the Global Ocean Reference Genome dataset of SAGs.

# Usage
This example analyzes paired-end reads.
You could specify *unpaired* readfiles like ```--seqs '*.fastq'```

```
### SETUP
module unload anaconda; module load anaconda                         ## Nextflow is installed in anaconda 2.1.0
WORKDIR=my_analysis                                                  ## Name for your analysis
cp -r /mnt/scgc_nfs/opt/gorg_classifier_v2/ ${WORKDIR}; cd $WORKDIR  ## Make the analysis directory & go there.


### RUN
nextflow run gorg_classifier_v2.1.nf \
--seqs './demo_reads/100ksub{1,2}.fq.gz' \
--db 'gorg_dark_v1' \
-profile 'charlie'
```

# How it works
Like [v1](https://github.com/BigelowLab/gorg-classifier), it takes reads as inputs (can be fasta, fastq, zipped or unzipped) then:
1. Uses [kaiju](https://github.com/bioinformatics-centre/kaiju) to map the reads to the database of reference SAGs.
2. Classifies the reads using the [GTDB](https://gtdb.ecogenomic.org/) taxonomy scheme and [GTDB-Tk] (https://github.com/Ecogenomics/GTDBTk).
3. Applies [Prokka](https://github.com/tseemann/prokka) annotations to the reads.
   
   <Br>--> **Output 1**: A table with per-read classifications and annotations<Br><br>
5. *New step.* **Clusterwise annotation**. Mapping a read to the closest reference SAG protein (step 3) often links the read to an unannotated protein (called "hypothetical protein" by Prokka). However, most unannotated proteins share sequence similarity (and potential relatedness) with proteins that are functionally annotated. Thus, by clustering proteins based on 60% minimum percent identity, we can transitively link many more reads to a functional annotation. These "secondhand" annotations are more biologically tenuous, but can provide important evolutionary context for the proteins, especially if your reads originate from a poorly taxon group.
   
   <Br>--> **Output 2**: A table with per-cluster readcounts, classifications, and annotations.


# Reference Databases (--db flag)
Currently **gorg_dark_v1** is the only DB in V2, but additional versions will soon be released.

# Interpreting the output tables:
### Output Table 1: "reads_classified"
  COLUMNS:
   * **status** -- 'C' for classified 'U' for unclassified
   * **read_name**
   * **taxid** -- GTDB taxid of SAG to which read mapped
   * **score_best_match**
   * **taxids_best_matches** BUG -- same as taxid
   * **accessions_best_matches** -- e.g. AH573P03_N9;3210;4877
   * **sequence_matching_fragment** -- The matching AA sequence generated by kaiju from the SAG contigs
   * **gtdb_R207_lineage** -- e.g.   'd__Bacteria;p__Chloroflexota;c__Dehalococcoidia;o__UBA3495;f__UBA3495;g__UBA3495;s__UBA3495'
   * **prokka_EC_number**
   * **prokka_product**
   * **swissprot_gene**
   * **swissprot_EC_number**
   * **swissprot_eggNOG**
   * **swissprot_KO**
   * **swissprot_Pfam**
   * **swissprot_CAZy**

### Output Table 2: "clusters"
  COLUMNS:
  Same as above, but with the addition of:
  * **number_of_reads**
  * **rank_encompassing_cluster** -- e.g. "species", "genus", "domain, or "prokaryotes" (if cluster spans both archaea and bacteria)
    



